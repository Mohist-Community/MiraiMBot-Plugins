plugins {
    id 'java'
    id 'org.jetbrains.kotlin.jvm' version '1.5.20-RC' // 请确保添加 Kotlin，至少使用 1.5 版本
}


group 'com.mohistmc.mcserverping'
version '0.2'

[compileJava, compileTestJava, javadoc]*.options*.encoding = 'UTF-8'

repositories {
    mavenCentral()
    maven { url 'https://maven.mohistmc.com/' }
}

dependencies {
    compile 'com.mohistmc:MiraiMBot:0.4-SNAPSHOT'
    annotationProcessor 'com.mohistmc:MiraiMBot:0.4-SNAPSHOT'
}

task unzip(type: Copy) {
    def zipFile = file('build/libs/' + project.name + '-' + project.version + '.jar')
    def outputDir = file("build/repack")
    FileTree jarTree = zipTree(zipFile)
    from jarTree
    into outputDir
}

task pack(type: Zip) {
    from 'build/repack'
    archiveName project.name + '-' + project.version + '.jar'
}

compileJava.dependsOn clean
build.dependsOn pack
pack.dependsOn unzip